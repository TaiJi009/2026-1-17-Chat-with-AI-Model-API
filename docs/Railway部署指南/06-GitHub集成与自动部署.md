# GitHub 集成与自动部署

Railway 支持与 GitHub 集成，实现代码推送自动部署的工作流。

## 启用自动部署

Railway 默认已启用自动部署。当您：

1. 推送代码到 GitHub 仓库
2. Railway 检测到推送（通过 Webhook）
3. 自动触发构建和部署流程
4. 部署完成后，服务会自动重启

## 部署分支配置

在服务的 **Settings → Deploy** 页面可以配置：

- **Branch**: 选择要部署的分支（默认：`main`）
- **Root Directory**: 后端代码目录（`backend`）
- **Watch Paths**: 指定哪些文件变更时触发部署（可选）

## 部署流程

```
本地开发
  ↓
git commit
  ↓
git push origin main
  ↓
GitHub 收到推送
  ↓
Railway Webhook 触发
  ↓
Railway 开始构建
  ↓
运行 npm install
  ↓
运行 npm run build
  ↓
部署新版本
  ↓
服务自动重启
```

## 禁用自动部署

如果需要手动控制部署：

1. 在服务 **Settings → Deploy** 页面
2. 找到 **"Auto Deploy"** 选项
3. 关闭自动部署
4. 需要部署时，在 **Deployments** 页面手动触发

## 部署历史

在服务的 **Deployments** 页面可以：

- 查看所有部署历史
- 查看每个部署的日志
- 回滚到之前的版本
- 查看部署时间和状态

## 手动触发部署

除了自动部署外，也可以手动触发部署：

1. 在服务的 **Deployments** 页面
2. 点击 **"Redeploy"** 按钮
3. 选择要部署的提交或分支

## 部署状态

部署状态包括：

- **Building**: 正在构建
- **Deploying**: 正在部署
- **Active**: 部署成功，服务运行中
- **Failed**: 部署失败
- **Inactive**: 服务已停止

## 回滚部署

如果新版本有问题，可以回滚到之前的版本：

1. 在 **Deployments** 页面
2. 找到之前的成功部署
3. 点击 **"Redeploy"** 按钮
4. 确认回滚

## 最佳实践

1. **使用分支策略**：
   - `main` 分支用于生产环境
   - `develop` 分支用于开发环境
   - 功能分支用于新功能开发

2. **测试后再部署**：
   - 在合并到 `main` 前进行充分测试
   - 使用 Pull Request 进行代码审查

3. **监控部署**：
   - 部署后监控应用状态
   - 查看日志确认服务正常运行

4. **保留部署历史**：
   - 不要删除部署历史
   - 保留以便回滚和问题排查

## 相关文档

- [详细步骤](02-详细步骤.md) - 了解如何配置 GitHub 集成
- [监控和日志](08-监控和日志.md) - 监控部署状态
- [故障排查](09-故障排查.md) - 如果部署失败，查看故障排查章节
