# 环境变量配置

## 环境变量列表

| 变量名 | 必需 | 说明 | 示例 |
|--------|------|------|------|
| `DATABASE_URL` | ✅ | PostgreSQL 连接字符串 | `${{PostgreSQL.DATABASE_URL}}` |
| `JWT_SECRET` | ✅ | JWT 密钥 | `your-secret-key` |
| `JWT_EXPIRES_IN` | ❌ | Token 过期时间 | `7d` |
| `PORT` | ✅ | 服务端口（Railway 自动提供） | `${{PORT}}` |
| `NODE_ENV` | ❌ | 运行环境 | `production` |
| `CORS_ORIGIN` | ✅ | 允许的跨域来源 | `https://your-frontend.com` |
| `WECHAT_APP_ID` | ❌ | 微信 AppID | `wx1234567890` |
| `WECHAT_MCH_ID` | ❌ | 微信商户号 | `1234567890` |
| `WECHAT_API_KEY` | ❌ | 微信 API Key | `your-api-key` |
| `WECHAT_NOTIFY_URL` | ❌ | 支付回调 URL | `https://your-domain.com/api/payment/wechat/callback` |
| `WECHAT_SANDBOX` | ❌ | 是否使用沙箱环境 | `false` |
| `TENCENT_SMS_SECRET_ID` | ❌ | 腾讯云 Secret ID | `AKID...` |
| `TENCENT_SMS_SECRET_KEY` | ❌ | 腾讯云 Secret Key | `your-secret-key` |
| `TENCENT_SMS_APP_ID` | ❌ | 短信应用 ID | `1400000000` |
| `TENCENT_SMS_SIGN_NAME` | ❌ | 短信签名 | `您的签名` |
| `TENCENT_SMS_TEMPLATE_ID` | ❌ | 短信模板 ID | `123456` |

## 配置环境变量的最佳实践

### 1. 使用引用变量

对于数据库连接等跨服务变量，使用 `${{ServiceName.VariableName}}` 引用：

```env
DATABASE_URL=${{PostgreSQL.DATABASE_URL}}
PORT=${{PORT}}
```

这样可以确保变量值自动同步，无需手动更新。

### 2. 敏感信息加密

Railway 会自动加密存储敏感信息，但您仍应该：

- 使用强随机字符串作为密钥（如 `JWT_SECRET`）
- 定期轮换 API 密钥和令牌
- 不要在代码中硬编码敏感信息

### 3. 区分环境

可以为不同的环境（开发/生产）创建不同的 Railway 项目：

- 开发环境：用于测试和开发
- 生产环境：用于正式部署

每个环境使用不同的环境变量值。

### 4. 批量导入

可以在 Variables 页面使用批量导入功能，一次性导入多个环境变量。

## 配置步骤

1. 在 Railway 项目中选择后端服务
2. 进入 **Settings → Variables** 页面
3. 点击 **"New Variable"** 添加环境变量
4. 输入变量名和值
5. 对于引用变量，使用 `${{ServiceName.VariableName}}` 格式

## 环境变量引用

Railway 支持使用 `${{ServiceName.VariableName}}` 引用其他服务的环境变量：

- `${{PostgreSQL.DATABASE_URL}}` - 引用 PostgreSQL 数据库连接字符串
- `${{PORT}}` - Railway 自动提供的端口号

## 注意事项

- 环境变量修改后，需要重新部署服务才能生效
- 可以在 **Deployments** 页面手动触发部署
- 或推送一个空提交到 GitHub 触发自动部署

## 相关文档

- [详细步骤](02-详细步骤.md) - 查看步骤 6 了解如何配置环境变量
- [故障排查](09-故障排查.md) - 如果环境变量未生效，查看故障排查章节
