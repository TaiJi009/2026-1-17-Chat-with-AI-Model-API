# 06-常用命令

## 服务管理

### 启动服务

```bash
docker-compose up -d
```

### 停止服务

```bash
docker-compose down
```

### 重启服务

```bash
# 重启所有服务
docker-compose restart

# 重启特定服务
docker-compose restart backend
docker-compose restart postgres
```

### 查看状态

```bash
docker-compose ps
```

### 查看日志

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f postgres

# 查看最近100行日志
docker-compose logs --tail=100 backend
```

## 数据库操作

### 运行迁移

```bash
docker-compose exec backend npm run migrate
```

### 备份数据库

```bash
docker-compose exec postgres pg_dump -U user chat_app > backup.sql
```

### 恢复数据库

```bash
docker-compose exec -T postgres psql -U user chat_app < backup.sql
```

### 进入数据库

```bash
docker-compose exec postgres psql -U user -d chat_app
```

在数据库命令行中可以执行 SQL 命令，例如：

```sql
-- 查看所有表
\dt

-- 查看用户表
SELECT * FROM users;

-- 退出
\q
```

## 容器操作

### 进入后端容器

```bash
docker-compose exec backend sh
```

在容器内可以执行命令，例如：

```bash
# 查看环境变量
env | grep DB_

# 查看文件
ls -la

# 退出容器
exit
```

### 查看容器资源使用

```bash
docker stats
```

### 重建容器

```bash
# 重新构建并启动
docker-compose up -d --build

# 强制重新构建（不使用缓存）
docker-compose build --no-cache
docker-compose up -d
```

### 查看容器详细信息

```bash
# 查看容器配置
docker-compose config

# 查看特定服务的配置
docker inspect chat_app_backend
```

## 相关文档

- [07-生产环境部署](./07-生产环境部署.md)
- [08-故障排查](./08-故障排查.md)
- [09-数据备份](./09-数据备份.md)
